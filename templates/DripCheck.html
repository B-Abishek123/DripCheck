<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DripCheck - Your Personal AI Outfit Advisor</title>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
    #resultsPage { display: none; }
    #mainContent { display: block; }
        /* Camera Modal Styles */
        .camera-modal .modal-content {
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .camera-container {
            width: 100%;
            margin: 0 auto;
            margin-bottom: 100;
            text-align: center;
            padding: 20px 0;
        }
        
        .camera-placeholder {
            width: 100%;
            height: 480px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #6c757d;
            margin: 0 auto 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .camera-timer {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: none; /* Hidden by default */
        }
        
        .captured-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.5rem;
            z-index: 10;
            display: none;
            animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.1); }
        }
        
        .capture-preview {
            position: relative;
            width: 100%;
            margin: 20px 0;
            display: none;
        }
        
        .capture-preview {
            max-width: 80%;
            margin: 20px auto;
            text-align: center;
        }
        
        .capture-preview img {
            max-width: 100%;
            max-height: 50vh;
            object-fit: contain;
            border-radius: 16px;
            border: 2px solid #eee;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .timer-slider {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            padding: 0 15px;
        }
        
        .timer-slider label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary-text);
            font-weight: 500;
        }
        
        .timer-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-cta);
            margin-left: 10px;
        }
        
        .submit-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary-cta), var(--secondary-action));
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.3);
        }
        
        .submit-btn:active {
            transform: translateY(1px);
        }
        
        .submit-btn i {
            font-size: 18px;
            transition: transform 0.3s ease;
        }
        
        .submit-btn:hover i {
            transform: scale(1.1);
        }
        
        .capture-btn {
            padding: 20px 40px;
            font-size: 1.2rem;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .capture-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.5);
        }
        
        .capture-btn:active {
            transform: translateY(1px);
        }
        
        .capture-btn i {
            margin-right: 8px;
            transition: transform 0.3s ease;
        }
        
        .capture-btn:hover i {
            transform: scale(1.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-text: #2C3E50; /* Primary Text: Deep Charcoal */
            --secondary-text: #6C757D; /* Secondary Text: Medium Gray */
            --primary-cta: #E53E3E; /* Primary CTA: Poppy Red */
            --secondary-action: #FA8D8D; /* Secondary Action: Coral Pink */
            --background-base: #FAF6C0; /* Background Base: Deeper Cream for better contrast */
            --shadow: rgba(229, 62, 62, 0.3); /* Shadow based on primary CTA */
            --gradient: linear-gradient(135deg, var(--primary-cta), var(--secondary-action));
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-base);
            color: var(--primary-text);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(253, 251, 212, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            border-bottom: 1px solid rgba(227, 83, 53, 0.2);
        }

        .logo {
            font-family: 'Kalam', cursive;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-cta);
            text-decoration: none;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile-btn, .settings-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .profile-btn:hover, .settings-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px var(--shadow);
        }

        .profile-btn:active, .settings-btn:active {
            transform: scale(0.95);
        }

        /* Dropdown Panels */
        .dropdown-panel {
            position: fixed;
            top: 80px;
            right: 30px;
            width: 320px;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            transform: translateY(-20px) scale(0.9);
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 999;
        }

        .dropdown-panel.active {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .settings-panel {
            right: 100px;
        }

        .panel-header {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-cta);
            margin-bottom: 20px;
            text-align: center;
        }

        .user-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 32px;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-email {
            color: var(--secondary-text);
            font-size: 14px;
        }

        .panel-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 12px;
            background: var(--gradient);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .panel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .panel-btn.danger {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
        }

        .section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            background-image: url("{{ url_for('static', filename='NewWebsiteBG3.png') }}");
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
            text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.7);
            min-height: 100vh;
            width: 100%;
            background-color: transparent;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
        }
        
        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }
        
        .welcome-section > * {
            position: relative;
            z-index: 2;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 1;
        }
        
        .welcome-section > * {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .welcome-title {
            font-family: 'Kalam', cursive;
            font-size: 5.5rem;
            font-weight: 700;
            color: var(--primary-cta);
            margin-top: 0px;
            padding-bottom: 0px;
            animation: fadeInUp 1s ease;
            line-height: 1.2;
            padding-top: 1.5rem;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: var(--primary-text);
            margin-bottom: 80px;
            font-weight: 200;
            margin-top: 0px;
            padding-bottom: 40px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease 0.2s both;
        }



        .welcome-subtitle1 {
            font-size: 1.8rem;
            color: var(--primary-text);
            margin-bottom: 50px;
            font-weight: 400;
            animation: fadeInUp 1s ease 0.2s both;
        }

        .action-buttons {
            display: flex;
            gap: 25px;
            max-width: 1000px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 20px 40px;
            font-size: 1.3rem;
            font-weight: 600;
            border: 3px solid #000;
            border-radius: 20px;
            background: #fff;
            color: #000;
            cursor: pointer;
            transition: all 0.4s ease;
            transform: translateY(0);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-width: 280px;
            margin-bottom: 150px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border-color: #000;
        }

        .action-btn:active {
            transform: translateY(-4px);
        }

        .action-btn i {
            margin-right: 12px;
            font-size: 1.2em;
        }

        /* Outfit Upload Section */
        .outfit-section {
            background: linear-gradient(135deg, rgba(227, 83, 53, 0.1), rgba(252, 156, 164, 0.1));
        }

        .outfit-title {
            font-family: 'Kalam', cursive;
            font-size: 7rem;
            font-weight: 700;
            color: var(--primary-cta);
            margin-bottom: 40px;
            text-align: center;
            text-shadow: -3px -1px 2px rgba(0, 0, 0, 0.8);
        }

        .outfit-buttons {   
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            text-shadow: -2px 0px 2px rgba(0, 0, 0, 0.8);
        }

        .outfit-btn {
            padding: 25px 45px;
            font-size: 1.4rem;
            font-weight: 600;
            border: 3px solid var(--primary-cta);
            border-radius: 20px;
            background: #fff;
            color: var(--primary-cta);
            cursor: pointer;
            transition: all 0.4s ease;
            min-width: 250px;
        }

        .outfit-btn:hover {
            background: var(--primary-cta);
            color: #fff;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow);
        }

        /* Results Page */
        .results-page {
            display: none;
            min-height: 100vh;
            padding: 100px 30px 50px;
        }

        .results-page.active {
            display: block;
        }

        .results-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .outfit-display {
            margin-bottom: 40px;
        }

        .outfit-image {
            width: 300px;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            margin: 0 auto 20px;
            display: block;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .outfit-rating {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary-cta);
            margin-bottom: 20px;
            transition: color 0.3s, transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.5s;
            opacity: 0;
            transform: translateY(30px);
        }

        .outfit-rating.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .rating-label {
            font-size: 1.5rem;
            color: var(--primary-text);
            margin-bottom: 30px;
        }

        .results-buttons {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .result-home-btn {
            padding: 20px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border: 3px solid var(--primary-cta);
            border-radius: 20px;
            background: white;
            color: var(--primary-cta);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
        }

        .result-home-btn:hover {
            background: var(--primary-cta);
            color: white;
            transform: translateY(-3px);
        }

        .result-btn {
            padding: 20px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border: 3px solid var(--primary-cta);
            border-radius: 20px;
            background: white;
            color: var(--primary-cta);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
        }

        .result-btn:hover {
            background: var(--primary-cta);
            color: white;
            transform: translateY(-3px);
        }

        .improvements {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: left;
            max-width: 800px;
            margin: 0 auto;
        }

        .suggestions-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        .outfit-preview {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .outfit-preview h3 {
            font-family: 'Kalam', cursive;
            color: var(--primary-cta);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .captured-outfit-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            object-fit: contain;
            margin: 0 auto;
            display: block;
            border: 2px solid #eee;
        }

        .suggestions-content {
            flex: 2;
        }

        .improvements-title {
            font-family: 'Kalam', cursive;
            font-size: 2rem;
            color: var(--primary-cta);
            margin-bottom: 25px;
            text-align: left;
        }

        .improvement-item {
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 16px;
            line-height: 1.6;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s, transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .improvement-item.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .improvement-item:last-child {
            border-bottom: none;
        }

        /* Modal for Manual Entry */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-family: 'Kalam', cursive;
            font-size: 2.5rem;
            color: var(--primary-cta);
            margin-bottom: 10px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            font-size: 30px;
            color: var(--secondary-text);
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-text);
        }

        .form-input, .form-select, .form-range, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-cta);
            box-shadow: 0 0 0 3px rgba(227, 83, 53, 0.1);
        }

        .form-range {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            padding: 0;
        }

        .form-range::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-cta);
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px var(--shadow);
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(253, 251, 212, 0.95);
            z-index: 3000;
            backdrop-filter: blur(10px);
        }

        .loading-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #e0e0e0;
            border-top: 8px solid var(--primary-cta);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        .loading-text {
            font-size: 1.5rem;
            color: var(--primary-cta);
            font-weight: 600;
        }

        .welcome-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 40px;
            width: 100%;
            max-width: 900px;
            padding: 0 20px;
        }

        .welcome-buttons .outfit-btn {
            min-width: 200px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .welcome-buttons {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .welcome-buttons .outfit-btn {
                width: 100%;
                max-width: 250px;
            }
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -350px;
            top: 80px;
            width: 350px;
            height: calc(100vh - 80px);
            background: #FFE5E2;
            box-shadow: 5px 0 30px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
            z-index: 900;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-toggle {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 901;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid #e0e0e0;
            text-align: center;
        }

        .sidebar-title {
            font-family: 'Inter', 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--primary-cta);
            margin-bottom: 15px;
        }

        .month-filter {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--primary-cta);
            border-radius: 10px;
            font-size: 14px;
        }

        .history-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(227, 83, 53, 0.05);
        }

        .history-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .history-date {
            font-size: 14px;
            color: var(--secondary-text);
            margin-bottom: 5px;
        }

        .history-rating {
            font-weight: 600;
            color: var(--primary-cta);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 5rem;
            }

            .welcome-subtitle {
                font-size: 1.3rem;
            }

            .outfit-title {
                font-size: 5rem;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .action-btn {
                min-width: 250px;
            }

            .outfit-buttons {
                flex-direction: column;
                align-items: center;
                text-shadow: -2px 0px 2px rgba(0, 0, 0, 0.8);
            }

            .results-buttons {
                flex-direction: column;
                align-items: center;
            }

            .sidebar {
                width: 300px;
                left: -300px;
            }

            .modal-content {
                width: 95%;
                padding: 30px 20px;
            }
        }

        /* Login Modal */
        .login-modal-content {
            max-width: 400px;
            padding: 40px 30px 30px 30px;
            background: #FFE5E2;
            color: #2C3E50;
            box-shadow: 0 8px 40px rgba(0,0,0,0.4);
            border-radius: 18px;
            position: relative;
            font-family: 'Inter', 'Poppins', sans-serif;
        }
        .login-social {
            display: flex;
            gap: 20px;
            margin-bottom: 18px;
            justify-content: center;
        }
        .social-btn {
            flex: 1;
            background: #181A1B;
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 2rem;
            padding: 12px 0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .social-btn.google-btn:hover { background: #ea4335; color: #fff; }
        .social-btn.facebook-btn:hover { background: #1877f3; color: #fff; }
        .login-divider {
            display: flex;
            align-items: center;
            margin: 18px 0 18px 0;
            color: #fff;
            font-size: 1.1rem;
        }
        .login-divider span {
            margin: 0 12px;
            color: #fff;
            opacity: 0.8;
        }
        .login-divider:before, .login-divider:after {
            content: '';
            flex: 1;
            height: 2px;
            background: #23262b;
            border-radius: 2px;
            opacity: 0.5;
        }
        .login-input {
            background: #fff;
            color: #2C3E50;
            border: none;
            margin-bottom: 16px;
            font-size: 1.1rem;
        }
        .login-input::placeholder {
            color: #888;
            opacity: 1;
        }
        .login-options {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }
        .remember-label {
            display: flex;
            align-items: center;
            font-size: 1.1rem;
            cursor: pointer;
            color: #fff;
            font-family: 'Fira Mono', 'Consolas', monospace;
        }
        .remember-label input[type="checkbox"] {
            display: none;
        }
        .custom-checkbox {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            background: #181A1B;
            border: 2px solid #444;
            margin-right: 8px;
            display: inline-block;
            position: relative;
        }
        .remember-label input[type="checkbox"]:checked + .custom-checkbox {
            background: #181A1B;
            border-color: #FFD600;
        }
        .remember-label input[type="checkbox"]:checked + .custom-checkbox:after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 8px;
            height: 13px;
            border: solid #FFD600;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }
        .forgot-link {
            color: #888;
            font-size: 1rem;
            text-decoration: none;
            transition: color 0.2s;
        }
        .forgot-link:hover { color: #FFD600; }
        .login-btn {
            background: #181A1B;
            color: #fff;
            font-family: 'Fira Mono', 'Consolas', monospace;
            font-size: 1.2rem;
            margin-top: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .login-btn:hover { background: #FFD600; color: #23262b; }
        .login-toggle {
            text-align: center;
            margin-top: 10px;
            color: #aaa;
            font-size: 1rem;
        }
        #toggleLink { color: #FFD600; cursor: pointer; text-decoration: underline; }
        #toggleLink:hover { color: #fff; }

        /* Update all secondary font usages to Inter */
        .panel-header, .user-email, .form-label, .form-input, .form-select, .form-range, .form-textarea, .rating-label, .improvement-item, .sidebar-title, .month-filter, .history-date, .history-rating, .login-btn, .login-toggle, .forgot-link, .remember-label, .result-btn, .submit-btn {
            font-family: 'Inter', 'Poppins', sans-serif !important;
        }


        .outfit-section {
            background-image: url("{{ url_for('static', filename='Section3BG3.png') }}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* Keep the existing gradient as a fallback */
            background: linear-gradient(135deg, rgba(227, 83, 53, 0.1), rgba(252, 156, 164, 0.1)), 
                        url("{{ url_for('static', filename='Section3BG3.png') }}");
            background-size: cover;
            background-position: center;
            padding-right: 500px;
            padding-bottom: 120px;
        }

        .section-title{
            font-family: 'Kalam', cursive;
            font-size: 4.5rem;
            text-align: center;
            color: var(--primary-cta);
        }

        #bodyDetailsTitle{
            padding-bottom: 40px;
            text-shadow: 1px 1.5px 2px rgba(0, 0, 0, 0.7);
        }
            
        

    #improvementsContent {
    padding-left: 100px;
    padding-right: 100px;
    line-height: 1.5;
    text-align: left;
    }

    @media (max-width: 768px) {
        #improvementsContent {
            padding-left: 16px;
            padding-right: 16px;
        }
    }

    section{
        width: 100%;
    }

    .footer{
        background-color: #eae49f;
        height: 20%;
    }

    .footer-title {
        font-family: 'Kalam', cursive;
        font-size: 10rem;
        text-align: center;
        font-weight: bold;
        margin-bottom: 0px;
        color: var(--primary-cta);
        text-shadow: 0 0 8px rgba(0,0,0, 0.2), 0 0 12px rgba(0,0,0, 0.2);
        transition: text-shadow 0.3s ease-in-out;
    }
    
    .footer-title:hover {
        text-shadow: 0 0 12px rgba(0,0,0, 0.25), 0 0 16px rgba(0,0,0, 0.25);
    }

    .footer-content{
        font-family: 'Inter', 'Poppins', sans-serif;
        text-align: center;
        font-size: 0.6rem;
        color: #000000;
    }

    .footer-name{
        color: grey;
        font-size: 1rem;
        margin-right: 20px;
        font-family: 'Fira Mono', 'Consolas', monospace;
        text-align: right;
        margin-left: 0px;
    }

    .footer-email{
        color: grey;
        font-size: 1rem;
        margin-right: 20px;
        margin-left:0px;
        font-family: 'Fira Mono', 'Consolas', monospace;
        text-align: right;
    }


</style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="#" class="logo" onclick="goHome()">DripCheck</a>
        <div class="nav-right">
            <button class="settings-btn" onclick="toggleSettings()">
                <i class="fas fa-cog"></i>
            </button>
            <button class="profile-btn" onclick="toggleProfile()">
                <i class="fas fa-user"></i>
            </button>
        </div>
    </nav>

    <!-- Profile Dropdown -->
    <div class="dropdown-panel" id="profilePanel">
        <div class="panel-header">Your Profile</div>
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-name">Welcome Back!</div>
            <div class="user-email">user@stylesync.com</div>
        </div>
        <button class="panel-btn" onclick="editProfile()">
            <i class="fas fa-edit"></i> Edit Body Details
        </button>
        <button class="panel-btn" onclick="viewHistory()">
            <i class="fas fa-history"></i> View History
        </button>
    </div>

    <!-- Settings Dropdown -->
    <div class="dropdown-panel settings-panel" id="settingsPanel">
        <div class="panel-header">Settings</div>
        <button class="panel-btn" onclick="openLoginModal()">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>
        <button class="panel-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
        <button class="panel-btn danger">
            <i class="fas fa-trash"></i> Delete Account
        </button>
    </div>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-history"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Outfit History</div>
            <select class="month-filter" onchange="filterByMonth(this.value)">
                <option value="">All Months</option>
                <option value="2024-12">December 2024</option>
                <option value="2024-11">November 2024</option>
                <option value="2024-10">October 2024</option>
            </select>
        </div>
        <div class="history-list">
            <div class="history-item" onclick="showOutfitDetails('Outfit 1', '8.5/10', 'December 15, 2024', 'https://via.placeholder.com/300x400/E35335/FFFFFF?text=Outfit+1')">
                <img src="https://via.placeholder.com/300x150/E35335/FFFFFF?text=Outfit+1" alt="Outfit 1" class="history-image">
                <div class="history-date">December 15, 2024</div>
                <div class="history-rating">Rating: 8.5/10</div>
            </div>
            <div class="history-item" onclick="showOutfitDetails('Outfit 2', '7.2/10', 'December 10, 2024', 'https://via.placeholder.com/300x400/FC9CA4/FFFFFF?text=Outfit+2')">
                <img src="https://via.placeholder.com/300x150/FC9CA4/FFFFFF?text=Outfit+2" alt="Outfit 2" class="history-image">
                <div class="history-date">December 10, 2024</div>
                <div class="history-rating">Rating: 7.2/10</div>
            </div>
            <div class="history-item" onclick="showOutfitDetails('Outfit 3', '9.1/10', 'December 5, 2024', 'https://via.placeholder.com/300x400/17A2B8/FFFFFF?text=Outfit+3')">
                <img src="https://via.placeholder.com/300x150/17A2B8/FFFFFF?text=Outfit+3" alt="Outfit 3" class="history-image">
                <div class="history-date">December 5, 2024</div>
                <div class="history-rating">Rating: 9.1/10</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Welcome Section -->
        <section class="section welcome-section" id="welcomeSection">
            <h1 class="welcome-title">Time for Your Daily DRIPCHECK</h1>
            <p class="welcome-subtitle">Your Mirror Lies. We Tell the Truth.</p>
        </section>

        <!-- Body Details Section -->
        <section class="section body-details-section">
            <h2 class="section-title" id="bodyDetailsTitle">Update your Body Details</h2>
            <div class="outfit-buttons" id="bodyDetailsButtons">
                <button class="outfit-btn" onclick="captureRealTime()">
                    <i class="fas fa-camera"></i>
                    Capture Now
                </button>
                <button class="outfit-btn" onclick="uploadPhoto()">
                    <i class="fas fa-upload"></i>
                    Upload Photo
                </button>
                <button class="outfit-btn" onclick="openManualEntry()">
                    <i class="fas fa-edit"></i>
                    Enter Manually
                </button>
            </div>
        </section>

        <!-- Outfit Upload Section -->
        <section class="section outfit-section" id="outfitSection">
            <h2 class="outfit-title">Strike a Pose</h2>
            <div class="outfit-buttons">
                <button class="outfit-btn" onclick="captureOutfit()">
                    <i class="fas fa-camera"></i>
                    Capture Outfit Now
                </button>
                <button class="outfit-btn" onclick="uploadOutfitPhoto()">
                    <i class="fas fa-image"></i>
                    Upload Outfit Photo
                </button>
            </div>
        </section>
    </div>

    <!-- Results Page -->
    <div class="results-page" id="resultsPage">
        <div class="results-container">
            <div class="outfit-display">
                <img src="" alt="Your Current Outfit" class="outfit-image" id="resultImage" style="max-width: 320px; max-height: 240px; border-radius: 16px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); margin: 0 auto; display: block; background: #f0f0f0;">
                <div class="outfit-rating" id="outfitRating"></div>
            </div>
            
            <div id="suggestionsPage">
                <div class="suggestions-container">
                    <div class="suggestions-content">
                        <h3 class="improvements-title" style="text-align: center;">Improvement Suggestions: </h3>
                        <div id="improvementsList"></div>
                        <div id="improvementsContent"></div>
                    </div>
                </div>
            </div>

            <div class="results-buttons">
                <button class="result-home-btn" onclick="goHome()">
                    <i class="fas fa-edit"></i> Home
                </button>
                <button class="result-btn" onclick="goToOutfitSection()">
                    <i class="fas fa-camera"></i> Capture Outfit
                </button>
            </div>

        </div>
    </div>

    <!-- Occasion Modal -->
    <div class="modal" id="occasionModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeOccasionModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Select Occasion</h2>
            </div>
            <div class="form-group">
                <label class="form-label" for="occasionSelect">Occasion</label>
                <select id="occasionSelect" class="form-select">
                    <option value="Casual">Casual</option>
                    <option value="Formal">Formal</option>
                    <option value="Party">Party</option>
                    <option value="Wedding">Wedding</option>
                    <option value="Romantic">Romantic</option>
                    <option value="Vacation">Vacation</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <button class="submit-btn" id="occasionConfirmBtn">Confirm</button>
        </div>
    </div>

<!-- Camera Capture Modal -->
    <!-- Outfit Capture Modal -->
    <div class="modal camera-modal" id="outfitCameraModal">
        <div class="modal-content">
            <button class="close-btn" id="outfitCloseBtn">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Capture Your Outfit</h2>
                <p>Frame your outfit in the camera to get recommendations.</p>
            </div>
            <div class="camera-container">
                <div style="position: relative; display: inline-block; width: 100%; max-height: 60vh; overflow: hidden; border-radius: 16px;">
                    <video id="outfitCameraFeed" width="100%" autoplay playsinline style="display: none; width: 100%; max-height: 60vh; object-fit: contain; border-radius: 16px; background: #f0f0f0;"></video>
                    <div id="outfitCountdown" class="camera-timer">3</div>
                </div>
                <canvas id="outfitCameraCanvas" style="display: none; max-width: 100%; border-radius: 16px;"></canvas>
                <div id="outfitCameraPlaceholder" class="camera-placeholder">
                    <i class="fas fa-tshirt" style="font-size: 64px; margin-bottom: 20px; color: var(--primary-cta);"></i>
                    <p style="font-size: 1.1rem; margin-bottom: 5px;">Camera access is required to capture your outfit</p>
                    <p style="font-size: 0.9rem; color: #6c757d;">We'll ask for permission to use your camera</p>
                </div>
                
                <!-- Timer Settings -->
                <div id="outfitTimerSettings" style="display: none; margin: 20px 0;">
                    <div class="timer-slider">
                        <label for="outfitTimerSlider">
                            Timer: <span id="outfitTimerValue" class="timer-value">Off</span>
                        </label>
                        <input type="range" id="outfitTimerSlider" min="0" max="10" value="0" class="slider" style="width: 100%;">
                    </div>
                </div>
                
                <div class="camera-preview" id="outfitCameraPreview" style="display: none;">
                    <img id="outfitCapturedImage" src="" alt="Captured Outfit Image" style="max-width: 320px; max-height: 240px; border-radius: 16px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); margin: 0 auto; display: block; background: #f0f0f0;">
                </div>
                
                <div class="camera-controls" style="margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <button id="outfitStartCameraBtn" class="submit-btn">
                            <i class="fas fa-video"></i> Start Camera
                        </button>
                        <button id="outfitCaptureBtn" class="capture-btn" style="display: none;">
                            <i class="fas fa-camera"></i> Capture
                        </button>
                        <button id="outfitRetakeBtn" class="submit-btn" style="background: #6c757d; display: none; min-width: 120px; justify-content: center;">
                            <i class="fas fa-redo"></i> Retake
                        </button>
                        <button id="outfitNextBtn" class="submit-btn" style="background: #28a745; display: none;">
                            <i class="fas fa-arrow-right"></i> Next
                        </button>
                    </div>

                    <div id="outfitCapturedMessage" class="captured-message">Outfit Captured!</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal camera-modal" id="cameraModal">
        <div class="modal-content">
            <button class="close-btn" id="cameraCloseBtn">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Capture Now</h2>
                <p>Allow camera access to capture your Body Details in Real Time</p>
            </div>
            <div class="camera-container">
                <div style="position: relative; display: inline-block; width: 100%; max-height: 60vh; overflow: hidden; border-radius: 16px;">
                    <video id="cameraFeed" width="100%" autoplay playsinline style="display: none; width: 100%; max-height: 60vh; object-fit: contain; border-radius: 16px; background: #f0f0f0;"></video>
                    <div id="countdown" class="camera-timer">3</div>
                </div>
                <canvas id="cameraCanvas" style="display: none; max-width: 100%; border-radius: 16px;"></canvas>
                <div id="cameraPlaceholder" class="camera-placeholder">
                    <i class="fas fa-camera" style="font-size: 64px; margin-bottom: 20px; color: var(--primary-cta);"></i>
                    <p style="font-size: 1.1rem; margin-bottom: 5px;">Camera access is required to capture your outfit</p>
                    <p style="font-size: 0.9rem; color: #6c757d;">We'll ask for permission to use your camera</p>
                </div>
                
                <!-- Timer Settings -->
                <div id="timerSettings" style="display: none; margin: 20px 0;">
                    <div class="timer-slider">
                        <label for="timerSlider">
                            Timer: <span id="timerValue" class="timer-value">Off</span>
                        </label>
                        <input type="range" id="timerSlider" min="0" max="10" value="0" class="slider" style="width: 100%;">
                    </div>
                </div>
                
                <div class="camera-preview" id="cameraPreview" style="display: none;">
                    <img id="capturedImage" src="" alt="Captured Image">
                </div>
                
                <div class="camera-controls" style="margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px;">
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <button id="startCameraBtn" class="submit-btn">
                            <i class="fas fa-video"></i> Start Camera
                        </button>
                        <button id="captureBtn" class="capture-btn" style="display: none;">
                            <i class="fas fa-camera"></i> Capture
                        </button>
                        <button id="retakeBtn" class="submit-btn" style="background: #6c757d; display: none; min-width: 120px; justify-content: center;">
                            <i class="fas fa-redo"></i> Retake
                        </button>
                        <button id="nextBtn" class="submit-btn" style="background: #28a745; display: none;">
                            <i class="fas fa-arrow-right"></i> Next
                        </button>
                    </div>

                    <div id="capturedMessage" class="captured-message">Captured!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Entry Modal -->
    <div class="modal" id="manualModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">Enter Your Details</h2>
                <p>Help us understand you better for personalized suggestions</p>
            </div>
            <form id="manualForm" onsubmit="submitManualForm(event)">
                <div class="form-group">
                    <label class="form-label">Age</label>
                    <input type="range" class="form-range" id="age" min="14" max="120" value="25" oninput="updateAgeValue(this.value)">
                    <span id="ageValue">25 years</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select class="form-select" id="gender">
                        <option value="Female">Female</option>
                        <option value="Male">Male</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Height (cm)</label>
                    <input type="range" class="form-range" id="height" min="100" max="250" value="165" oninput="updateHeightValue(this.value)">
                    <span id="heightValue">165 cm</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Weight (kg)</label>
                    <input type="range" class="form-range" id="weight" min="30" max="450" value="60" oninput="updateWeightValue(this.value)">
                    <span id="weightValue">60 kg</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Body Shape</label>
                    <select class="form-select" id="bodyType">
                        <option value="Slim">Slim</option>
                        <option value="Average">Average</option>
                        <option value="Athletic">Athletic</option>
                        <option value="Curvy">Curvy</option>
                        <option value="Bulky">Bulky</option>
                        <option value="PreferNotToSay">Prefer Not To Say</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Face Shape</label>
                    <select class="form-select" id="faceShape">
                        <option value="Oval">Oval</option>
                        <option value="Round">Round</option>
                        <option value="Square">Square</option>
                        <option value="Heart">Heart</option>
                        <option value="Diamond">Diamond</option>
                        <option value="Rectangle">Rectangle</option>
                        <option value="Triangle">Triangle</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Hair Color</label>
                    <select class="form-select" id="hairColor">
                        <option value="Black">Black</option>
                        <option value="Brown">Brown</option>
                        <option value="Blonde">Blonde</option>
                        <option value="Red">Red</option>
                        <option value="Gray">Gray</option>
                        <option value="White">White</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Skin Tone</label>
                    <select class="form-select" id="skinTone">
                        <option value="VeryFair">Very Fair</option>
                        <option value="Fair">Fair</option>
                        <option value="Medium">Medium</option>
                        <option value="Brown">Brown</option>
                        <option value="Dark">Dark</option>
                        <option value="PreferNotToSay">Prefer Not To Say</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Style Preferences</label>
                    <textarea class="form-textarea" id="preferences" placeholder="Tell us about your style preferences, favorite colors, favorite dresses, etc."></textarea>
                </div>

                <button type="submit" class="submit-btn">Update</button>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content login-modal-content">
            <button class="close-btn" onclick="closeLoginModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="loginModalTitle">Sign In</h2>
            </div>
            <div class="login-social">
                <button class="social-btn google-btn"><i class="fab fa-google"></i></button>
                <button class="social-btn facebook-btn"><i class="fab fa-facebook-f"></i></button>
            </div>
            <div class="login-divider"><span>or</span></div>
            <form id="loginForm">
                <input type="text" class="form-input login-input" id="signupName" placeholder="name" style="display:none;">
                <input type="email" class="form-input login-input" id="loginEmail" placeholder="email" required>
                <input type="password" class="form-input login-input" id="loginPassword" placeholder="password" required>
                <input type="password" class="form-input login-input" id="signupConfirm" placeholder="confirm password" style="display:none;">
                <div class="login-options">
                    <label class="remember-label">
                        <input type="checkbox" id="rememberMe">
                        <span class="custom-checkbox"></span>
                        remember me
                    </label>
                    <a href="#" class="forgot-link" onclick="forgotPassword()">forgot password?</a>
                </div>
                <div id="loginError" style="color:#e53e3e; font-size:1rem; margin-bottom:8px; display:none;"></div>
                <button type="submit" class="submit-btn login-btn"><i class="fas fa-sign-in-alt"></i> <span id="loginBtnText">sign in</span></button>
            </form>
            <div class="login-toggle">
                <span id="toggleText">New user?</span> <a href="#" onclick="toggleLoginSignup()" id="toggleLink">Sign up</a>
            </div>
        </div>
    </div>


    <section class="footer">
        <div class="footer-title">DripCheck</div>
        <div class="footer-name">
            b-abishek
        </div>
        <div class="footer-email">
            babishek000@gmail.com
        </div>
        <div class="footer-content">
            <p> 2025 DripCheck. All rights reserved.</p>
        </div>
    </section>
    <script>
let hasCapturedImage = false;

// Manual form submit handler
async function submitManualForm(event) {
    event.preventDefault();
    // Collect all manual entry values
    const age = document.getElementById('age').value;
    const gender = document.getElementById('gender').value;
    const height = document.getElementById('height').value;
    const weight = document.getElementById('weight').value;
    const bodyType = document.getElementById('bodyType').value;
    const faceShape = document.getElementById('faceShape').value;
    const hairColor = document.getElementById('hairColor').value;
    const skinTone = document.getElementById('skinTone').value;
    const preferences = document.getElementById('preferences').value;

    showLoading('Processing your Body Details...');
    try {
        const resp = await fetch('/manual_body_details', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                age, gender, height, weight, bodyType, faceShape, hairColor, skinTone, preferences
            })
        });
        const data = await resp.json();
        hideLoading();
        if (resp.ok) {
            const bodyDetails = data.body_details || data;
            localStorage.setItem('bodyDetails', JSON.stringify(bodyDetails));
            closeModal();
            showResults(bodyDetails);
            goToOutfitSection();
        } else {
            alert('Server error');
        }
    } catch (err) {
        hideLoading();
        alert('Network error');
    }
}

    // Modal open/close
    function openLoginModal() {
        document.getElementById('loginModal').style.display = 'block';
    }
    function closeLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
    }
    // Toggle between sign in and sign up
    let isSignUp = false;
    function toggleLoginSignup() {
        isSignUp = !isSignUp;
        document.getElementById('loginModalTitle').textContent = isSignUp ? 'Sign Up' : 'Sign In';
        document.getElementById('loginBtnText').textContent = isSignUp ? 'sign up' : 'sign in';
        document.getElementById('toggleText').textContent = isSignUp ? 'Already have an account?' : 'New user?';
        document.getElementById('toggleLink').textContent = isSignUp ? 'Sign in' : 'Sign up';
        // Show/hide sign up fields
        document.getElementById('signupName').style.display = isSignUp ? '' : 'none';
        document.getElementById('signupConfirm').style.display = isSignUp ? '' : 'none';
        document.getElementById('loginError').style.display = 'none';
    }
    // Forgot password placeholder
    function forgotPassword() {
        alert('Password reset link would be sent to your email (UI only).');
    }
    // Social login placeholders
    window.addEventListener('DOMContentLoaded', function() {
        const googleBtn = document.querySelector('.google-btn');
        const facebookBtn = document.querySelector('.facebook-btn');

        // Form submit placeholder
        const loginForm = document.getElementById('loginForm');
        if (loginForm) loginForm.onsubmit = async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            errorDiv.style.display = 'none';
            if (isSignUp) {
                const name = document.getElementById('signupName').value.trim();
                const confirm = document.getElementById('signupConfirm').value;
                // Basic validation
                if (!name) { errorDiv.textContent = 'Name is required.'; errorDiv.style.display = 'block'; return; }
                if (!email.match(/^\S+@\S+\.\S+$/)) { errorDiv.textContent = 'Enter a valid email.'; errorDiv.style.display = 'block'; return; }
                if (password.length < 6) { errorDiv.textContent = 'Password must be at least 6 characters.'; errorDiv.style.display = 'block'; return; }
                if (password !== confirm) { errorDiv.textContent = 'Passwords do not match.'; errorDiv.style.display = 'block'; return; }
                // Placeholder API call
                try {
                    const resp = await fetch('/api/signup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, password })
                    });
                    if (!resp.ok) {
                        const data = await resp.json();
                        errorDiv.textContent = data.error || 'Sign up failed.';
                        errorDiv.style.display = 'block';
                        return;
                    }
                    alert('Account created! You can now sign in.');
                    toggleLoginSignup();
                } catch (err) {
                    errorDiv.textContent = 'Network error. Please try again.';
                    errorDiv.style.display = 'block';
                }
            } else {
                // Sign in logic (placeholder)
                if (!email.match(/^\S+@\S+\.\S+$/)) { errorDiv.textContent = 'Enter a valid email.'; errorDiv.style.display = 'block'; return; }
                if (!password) { errorDiv.textContent = 'Password is required.'; errorDiv.style.display = 'block'; return; }
                // Placeholder: replace with real API call
                alert('Signed in! (UI only)');
                closeLoginModal();
            }
        };
    });
    // Close modal on outside click
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('loginModal');
        if (event.target === modal) {
            closeLoginModal();
        }
    });



    // Dropdown functionality for profile, settings, and sidebar
        function toggleProfile() {
            const profilePanel = document.getElementById('profilePanel');
            const settingsPanel = document.getElementById('settingsPanel');
            profilePanel.classList.toggle('active');
            settingsPanel.classList.remove('active');
        }
        function toggleSettings() {
            const settingsPanel = document.getElementById('settingsPanel');
            const profilePanel = document.getElementById('profilePanel');
            settingsPanel.classList.toggle('active');
            profilePanel.classList.remove('active');
        }
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
    // Unified click handler for modals and dropdowns
    window.addEventListener('click', function(event) {
        // Login modal
        const loginModal = document.getElementById('loginModal');
        if (loginModal && event.target === loginModal) {
            closeLoginModal();
        }
        // Manual entry modal
        const manualModal = document.getElementById('manualModal');
        if (manualModal && event.target === manualModal) {
            closeModal();
        }
        // Dropdowns
            const profilePanel = document.getElementById('profilePanel');
            const settingsPanel = document.getElementById('settingsPanel');
            const profileBtn = document.querySelector('.profile-btn');
            const settingsBtn = document.querySelector('.settings-btn');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.querySelector('.sidebar-toggle');
        if (profilePanel && !profileBtn.contains(event.target) && !profilePanel.contains(event.target)) {
                profilePanel.classList.remove('active');
            }
        if (settingsPanel && !settingsBtn.contains(event.target) && !settingsPanel.contains(event.target)) {
                settingsPanel.classList.remove('active');
            }
        if (sidebar && !sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                sidebar.classList.remove('active');
            }
        });

    function showLoading(message = 'Analyzing your outfit...') {
        let loading = document.querySelector('.loading');
        if (!loading) {
            loading = document.createElement('div');
            loading.className = 'loading';
            loading.style.display = 'block';
            loading.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">${message}</div>
                    <p>This may take a little longer</p>
                </div>
            `;
            document.body.appendChild(loading);
        } else {
            loading.querySelector('.loading-text').textContent = message;
            loading.style.display = 'block';
        }
    }
    function hideLoading() {
        const loading = document.querySelector('.loading');
        if (loading) loading.remove();
    }
    function showResults(result) {
        // Display the recommendation result in a more user-friendly way
        const resultsPage = document.getElementById('resultsPage');
        const resultsContent = document.getElementById('resultsContent');
        
        if (!resultsPage || !resultsContent) {
            return 1; alert('Results page or content not found');
        }
        
        // Update the results content
        if (result) {
            // Format the result for display
            let resultHTML = '<div class="result-section">';
            
            // Check if the result is a string (could be JSON or plain text)
            if (typeof result === 'string') {
                try {
                    // Try to parse as JSON
                    const parsedResult = JSON.parse(result);
                    // If it's an object, format it nicely
                    if (typeof parsedResult === 'object' && parsedResult !== null) {
                        resultHTML += formatObjectAsHTML(parsedResult);
                    } else {
                        resultHTML += `<p>${parsedResult}</p>`;
                    }
                } catch (e) {
                    // If not JSON, display as plain text
                    resultHTML += `<p>${result}</p>`;
                }
            } else if (typeof result === 'object' && result !== null) {
                // If it's already an object, format it
                resultHTML += formatObjectAsHTML(result);
            } else {
                resultHTML += `<p>${String(result)}</p>`;
            }
            
            resultHTML += '</div>';
            
            resultsContent.innerHTML = resultHTML;
        } else {
            ;
        }
        
        // Show the results page and hide the main content
        document.getElementById('mainContent').style.display = 'none';
        resultsPage.style.display = 'block';
        
        // Scroll to top of results
        window.scrollTo(0, 0);
    }
    
    // Helper function to format an object as HTML
    function formatObjectAsHTML(obj) {
        let html = '';
        for (const [key, value] of Object.entries(obj)) {
            const formattedKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
            if (typeof value === 'object' && value !== null) {
                html += `<div class="result-group">
                            <h3>${formattedKey}</h3>
                            <div class="result-value">${formatObjectAsHTML(value)}</div>
                        </div>`;
            } else {
                html += `<div class="result-item">
                            <strong>${formattedKey}:</strong> ${value || 'N/A'}
                        </div>`;
            }
        }
        return html;
    }

        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('resultsPage').classList.add('active');
        // Set default rating and suggestions if not set
        const rating = document.getElementById('outfitRating');
        if (rating) {
            rating.classList.add('visible');
        }
        const improvementsList = document.getElementById('improvementsList');
        if (improvementsList) {
            improvementsList.innerHTML = "";
            // Add .visible class to each improvement item for animation
            setTimeout(() => {
                document.querySelectorAll('.improvement-item').forEach(item => item.classList.add('visible'));
            }, 50);
        }
        // Animate the results with a staggered effect
        function animateResults() {
            const elements = document.querySelectorAll('.result-card, .rating-container, .improvement-item, .result-buttons');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, 100 * index);
            });
        }
        
        // Start the animation
        setTimeout(animateResults, 100);
    
    function goHome() {
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('resultsPage').classList.remove('active');
    }
    function goToOutfitSection() {
        goHome();
        document.getElementById('outfitSection').scrollIntoView({ behavior: 'smooth' });
    }
        function openManualEntry() {
            document.getElementById('manualModal').style.display = 'block';
        }
        function closeModal() {
            document.getElementById('manualModal').style.display = 'none';
        }
        // Function to properly close the camera modal
        function closeCameraModal() {
            stopCamera();
            const cameraModal = document.getElementById('cameraModal');
            cameraModal.style.display = 'none';
            if (hasCapturedImage) {
                // Don't reset UI, just hide modal
                return;
            }
            const video = document.getElementById('cameraFeed');
            stopCamera();
            
            // Clear any running countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
                const countdownElement = document.getElementById('countdown');
                if (countdownElement) {
                    countdownElement.style.display = 'none';
                }
            }
            
            // Stop all video tracks
            if (currentStream) {
                currentStream.getTracks().forEach(track => {
                    track.stop();
                    currentStream.removeTrack(track);
                });
                currentStream = null;
                if (video) {
                    video.srcObject = null;
                }
            }
            
            // Reset modal state
            if (document.getElementById('cameraPlaceholder')) {
                document.getElementById('cameraPlaceholder').style.display = 'flex';
            }
            if (video) {
                video.style.display = 'none';
            }
            
            const elementsToReset = [
                'captureBtn', 'retakeBtn', 'nextBtn', 'startCameraBtn',
                'timerSettings', 'cameraPreview', 'capturedMessage'
            ];
            
            elementsToReset.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.display = id === 'startCameraBtn' ? 'inline-flex' : 'none';
                }
            });
            
            // Re-enable all buttons
            const buttons = [
                'captureBtn', 'retakeBtn', 'nextBtn', 'startCameraBtn'
            ];
            
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.disabled = false;
                }
            });
            
            if (cameraModal) {
                cameraModal.style.display = 'none';
            }
        }
        
        // Make sure close button works
    

    function editProfile() {
        openManualEntry();
    }
    
    function viewHistory() {
        document.getElementById('profilePanel').classList.remove('active');
        document.getElementById('settingsPanel').classList.remove('active');
        toggleSidebar();
    }
    // Global variables for camera functionality
    let countdownInterval = null;
    let currentStream = null;
    
    // Button handlers
    function captureRealTime() {
        // Show the camera modal
        document.getElementById('cameraModal').style.display = 'flex';
    }
        
        // Update timer display
        const timerSlider = document.getElementById('timerSlider');
        const timerValue = document.getElementById('timerValue');
        
        if (timerSlider) {
            timerSlider.addEventListener('input', function() {
                const value = this.value;
                timerValue.textContent = value === '0' ? 'Off' : `${value}s`;
            });
        }
        
        // Show captured message
        function showCapturedMessage() {
            const message = document.getElementById('capturedMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 2000);
        }
        
        // Start countdown
        function startCountdown(seconds, callback) {
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'flex';
            
            let current = seconds;
            countdownElement.textContent = current;
            
            // Clear any existing interval
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                current--;
                countdownElement.textContent = current;
                
                if (current <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.style.display = 'none';
                    if (callback) callback();
                }
            }, 1000);
        }
        
    // Initialize camera function
    async function initCamera() {
        try {
            const video = document.getElementById('cameraFeed');
            // Stop any existing stream
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
            
            // Request camera access
            currentStream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    facingMode: 'environment' 
                } 
            });
            
            // Set up video element
            video.srcObject = currentStream;
            video.style.display = 'block';
            document.getElementById('cameraPlaceholder').style.display = 'none';
            document.getElementById('startCameraBtn').style.display = 'none';
            document.getElementById('captureBtn').style.display = 'inline-flex';
            document.getElementById('cameraPreview').style.display = 'none';
            
            // Show timer settings
            document.getElementById('timerSettings').style.display = 'block';
            
            // Set up event listeners
            setupCaptureButton();
            setupRetakeButton();
            setupNextButton();
            
        } catch (err) {
            alert('Could not access the camera. Please make sure you have granted camera permissions.');
        }
    }

    function stopCamera() {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
        }
        document.getElementById('cameraFeed').srcObject = null;
    }
    
    // Set up capture button
    function setupCaptureButton() {
        const captureBtn = document.getElementById('captureBtn');
        if (!captureBtn) return;
        
        // Remove any existing click handlers to prevent duplicates
        const newBtn = captureBtn.cloneNode(true);
        captureBtn.parentNode.replaceChild(newBtn, captureBtn);
        
        newBtn.onclick = function() {
            const canvas = document.getElementById('cameraCanvas');
            const video = document.getElementById('cameraFeed');
            const timerSeconds = parseInt(document.getElementById('timerSlider').value);
            
            // Disable buttons during countdown
            const buttons = ['captureBtn', 'retakeBtn', 'nextBtn', 'startCameraBtn'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = true;
            });
            
            // Function to take the actual picture
            const takePicture = () => {
                // Set canvas dimensions to match video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Draw video frame to canvas
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Process the captured image
                processCapturedImage(canvas, video);
                
                // Re-enable buttons
                buttons.forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) btn.disabled = false;
                });
            };
            
            // Start countdown if timer is enabled
            if (timerSeconds > 0) {
                startCountdown(timerSeconds, takePicture);
            } else {
                // Take picture immediately if timer is off
                takePicture();
            }
        };
    }

    // Process and preview the captured image
    function processCapturedImage(canvas, video) {
        hasCapturedImage = true;
        // Hide the video feed
        video.style.display = 'none';
        // Ensure the canvas is inside the same wrapper as the video
        const wrapper = video.parentNode;
        if (wrapper && wrapper.contains(canvas) === false) {
            wrapper.appendChild(canvas);
        }
        // Resize the canvas to a smaller preview (e.g., 70% of original)
        const scaleFactor = 0.7;
        const scaledWidth = canvas.width * scaleFactor;
        const scaledHeight = canvas.height * scaleFactor;
        // Create a temporary off-screen canvas to draw the scaled image
        const off = document.createElement('canvas');
        off.width = scaledWidth;
        off.height = scaledHeight;
        off.getContext('2d').drawImage(canvas, 0, 0, scaledWidth, scaledHeight);
        // Draw the scaled image back onto the visible canvas
        canvas.width = scaledWidth;
        canvas.height = scaledHeight;
        canvas.getContext('2d').drawImage(off, 0, 0, scaledWidth, scaledHeight);
        // Display the canvas in place
        canvas.style.display = 'block';
        canvas.style.maxWidth = '100%';
        canvas.style.height = 'auto';
        canvas.style.borderRadius = '16px';
        canvas.style.background = '#f0f0f0';
        // Hide placeholder if visible
        const placeholder = document.getElementById('cameraPlaceholder');
        if (placeholder) placeholder.style.display = 'none';
        // Show retake and next buttons, hide capture
        document.getElementById('retakeBtn').style.display = 'inline-flex';
        document.getElementById('nextBtn').style.display = 'inline-flex';
        document.getElementById('captureBtn').style.display = 'none';
    }
    
    // Set up retake button
    function setupRetakeButton() {
        const retakeBtn = document.getElementById('retakeBtn');
        if (!retakeBtn) return;
        
        // Remove any existing click handlers to prevent duplicates
        const newBtn = retakeBtn.cloneNode(true);
        retakeBtn.parentNode.replaceChild(newBtn, retakeBtn);
        
        newBtn.onclick = function() {
            // Hide preview and show camera again
            document.getElementById('cameraPreview').style.display = 'none';
            document.getElementById('captureBtn').style.display = 'inline-flex';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('timerSettings').style.display = 'block';

            // Hide the captured canvas in the video wrapper area
            const video = document.getElementById('cameraFeed');
            const canvas = document.getElementById('cameraCanvas');
            if (canvas) {
                canvas.style.display = 'none';
                // Optionally clear the canvas
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            // Show the video feed again
            if (video) video.style.display = 'block';
            hasCapturedImage = false;
            
            // Clear any existing interval
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
                const countdownElement = document.getElementById('countdown');
                if (countdownElement) {
                    countdownElement.style.display = 'none';
                }
            }
            
            // Restart the camera
            initCamera();
        };
    }
    
    // Set up next button
    function setupNextButton() {
        const nextBtn = document.getElementById('nextBtn');
        if (!nextBtn) return;
        
        // Remove any existing click handlers to prevent duplicates
        const newBtn = nextBtn.cloneNode(true);
        nextBtn.parentNode.replaceChild(newBtn, nextBtn);
        
        newBtn.onclick = function() {
            stopCamera();
            showLoading('Processing your Body Details...');
            const canvas = document.getElementById('cameraCanvas');
            if (!canvas) { hideLoading(); alert('No captured image'); return; }

            // Convert canvas to Blob and send to backend
            canvas.toBlob(async blob => {
                const formData = new FormData();
                formData.append('image', blob, 'capture.png');
                try {
                    stopCamera();
                    const resp = await fetch('/image_body_details', {
                        method: 'POST',
                        body: formData
                    });
                    const data = await resp.json();
                    hideLoading();
                    if (resp.ok) {
                        const bodyDetails = data.body_details || data;
                        // Store for later use (e.g., in outfit recommendation step)
                        localStorage.setItem('bodyDetails', JSON.stringify(bodyDetails));
                        closeCameraModal();
                        // Optionally show results somewhere or simply move to outfit section
                        showResults(bodyDetails);
                        goToOutfitSection();
                    } else {
                        alert('Server error');
                    }
                } catch (err) {
                    hideLoading();
                    alert('Network error');
                }
            }, 'image/png');
        };
    }
    
    // All modal and camera button listeners (consolidated)
    document.addEventListener('DOMContentLoaded', function() {
        const startCameraBtn = document.getElementById('startCameraBtn');
        if (startCameraBtn) startCameraBtn.onclick = initCamera;
        const cameraCloseBtn = document.getElementById('cameraCloseBtn');
        if (cameraCloseBtn) cameraCloseBtn.addEventListener('click', closeCameraModal);
        // ... (keep any other modal event setup here)
    });
    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
        const cameraModal = document.getElementById('cameraModal');
        if (event.target === cameraModal || event.target.classList.contains('close-btn')) {
            closeCameraModal();
        }
    });
    
    // Initialize event listeners when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Set up initial button handlers
        setupCaptureButton();
        setupRetakeButton();
        setupNextButton();
        
        // Set up timer slider
        const timerSlider = document.getElementById('timerSlider');
        const timerValue = document.getElementById('timerValue');
        if (timerSlider && timerValue) {
            timerSlider.addEventListener('input', function() {
                const value = this.value;
                timerValue.textContent = value === '0' ? 'Off' : `${value}s`;
            });
        }
    });

        // ---- Occasion Modal Logic ----
    function openOccasionModal(callback){
        const modal = document.getElementById('occasionModal');
        const confirmBtnOrig = document.getElementById('occasionConfirmBtn');
        // Clone to remove previous handlers and avoid duplicates
        const confirmBtn = confirmBtnOrig.cloneNode(true);
        confirmBtnOrig.parentNode.replaceChild(confirmBtn, confirmBtnOrig);
        confirmBtn.onclick = function(){
            const selected = document.getElementById('occasionSelect').value;
            localStorage.setItem('occasion', selected);
            closeOccasionModal();
            if(callback) callback();
        };
        modal.style.display = 'flex';
    }
    function closeOccasionModal(){
        const modal = document.getElementById('occasionModal');
        if(modal) modal.style.display='none';
    }

// --- OUTFIT CAMERA MODAL LOGIC ---
    let outfitStream;
    let outfitCountdownInterval;

    function openOutfitCameraModal() {
        document.getElementById('outfitCameraModal').style.display = 'flex';
        // No need to call initOutfitCamera here, user will click 'Start Camera'
    }

    function closeOutfitCameraModal() {
        if (outfitStream) {
            outfitStream.getTracks().forEach(track => track.stop());
            outfitStream = null;
        }
        document.getElementById('outfitCameraModal').style.display = 'none';
        clearInterval(outfitCountdownInterval);
    }
    
    // Make functions globally available
    window.openOutfitCameraModal = openOutfitCameraModal;
    window.closeOutfitCameraModal = closeOutfitCameraModal;
    window.initOutfitCamera = initOutfitCamera;

    async function initOutfitCamera() {
        const video = document.getElementById('outfitCameraFeed');
        const placeholder = document.getElementById('outfitCameraPlaceholder');
        const startBtn = document.getElementById('outfitStartCameraBtn');
        const captureBtn = document.getElementById('outfitCaptureBtn');
        const timerSettings = document.getElementById('outfitTimerSettings');

        try {
            outfitStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            video.srcObject = outfitStream;
            video.style.display = 'block';
            placeholder.style.display = 'none';
            startBtn.style.display = 'none';
            captureBtn.style.display = 'inline-block';
            timerSettings.style.display = 'block';
        } catch (err) {
            placeholder.innerHTML = '<p>Could not access camera. Please check permissions.</p>';
        }
    }

    function captureOutfitImage() {
        const timerSlider = document.getElementById('outfitTimerSlider');
        const seconds = parseInt(timerSlider.value, 10);

        if (seconds > 0) {
            startOutfitCountdown(seconds, takeOutfitPicture);
        } else {
            takeOutfitPicture();
        }
    }

    function takeOutfitPicture() {
        const video = document.getElementById('outfitCameraFeed');
        const canvas = document.getElementById('outfitCameraCanvas');
        const preview = document.getElementById('outfitCameraPreview');
        const capturedImg = document.getElementById('outfitCapturedImage');
        const context = canvas.getContext('2d');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        const dataUrl = canvas.toDataURL('image/jpeg');
        capturedImg.src = dataUrl;
        video.style.display = 'none';
        preview.style.display = 'block';

        document.getElementById('outfitCaptureBtn').style.display = 'none';
        document.getElementById('outfitRetakeBtn').style.display = 'inline-block';
        document.getElementById('outfitNextBtn').style.display = 'inline-block';
        document.getElementById('outfitTimerSettings').style.display = 'none';
        showOutfitCapturedMessage();
    }

    function retakeOutfit() {
        document.getElementById('outfitCameraFeed').style.display = 'block';
        document.getElementById('outfitCameraPreview').style.display = 'none';
        document.getElementById('outfitCaptureBtn').style.display = 'inline-block';
        document.getElementById('outfitRetakeBtn').style.display = 'none';
        document.getElementById('outfitNextBtn').style.display = 'none';
        document.getElementById('outfitTimerSettings').style.display = 'block';
    }

    function startOutfitCountdown(seconds, callback) {
        const countdownElement = document.getElementById('outfitCountdown');
        countdownElement.style.display = 'flex';
        let current = seconds;
        countdownElement.textContent = current;

        if (outfitCountdownInterval) clearInterval(outfitCountdownInterval);

        outfitCountdownInterval = setInterval(() => {
            current--;
            countdownElement.textContent = current;
            if (current <= 0) {
                clearInterval(outfitCountdownInterval);
                countdownElement.style.display = 'none';
                if (callback) callback();
            }
        }, 1000);
    }

    function showOutfitCapturedMessage() {
        const message = document.getElementById('outfitCapturedMessage');
        message.style.display = 'block';
        setTimeout(() => { message.style.display = 'none'; }, 2000);
    }

    // Move event listeners to ensure they're attached early
    function setupOutfitCameraListeners() {
        const startBtn = document.getElementById('outfitStartCameraBtn');
        const captureBtn = document.getElementById('outfitCaptureBtn');
        const closeBtn = document.getElementById('outfitCloseBtn');
        
        if (startBtn) {
            startBtn.onclick = initOutfitCamera;
        }
        if (captureBtn) {
            captureBtn.onclick = captureOutfitImage;
        }
        if (closeBtn) {
            closeBtn.onclick = closeOutfitCameraModal;
        }
    }
    
    // Set up listeners when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        setupOutfitCameraListeners();
        document.getElementById('outfitRetakeBtn').addEventListener('click', retakeOutfit);
        document.getElementById('outfitNextBtn').addEventListener('click', () => {
        closeOutfitCameraModal();
        const capturedImage = document.getElementById('outfitCapturedImage').src;
        const user_data = localStorage.getItem('bodyDetails');
        
        if (!capturedImage || !user_data) {
            alert('Missing required data. Please make sure you have entered all details and captured an image.');
            return;
        }
        
        // Show occasion modal first
        openOccasionModal(async function() {
            const occasion = localStorage.getItem('occasion');
            if (!occasion) {
                alert('Please select an occasion');
                return;
            }
            
            closeOutfitCameraModal();
            showLoading('Processing your Outfit Details...');
            try {
                stopCamera();
                const resp = await fetch('/recommend/capture', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        outfitImage: capturedImage,
                        occasion: occasion,
                        user_data: user_data
                    })
                });
                const data = await resp.json().catch(e => {
                    throw new Error('Invalid server response');
                });
                

                if (!resp.ok) {
                    throw new Error(data.error || 'Server returned an error');
                }
                
                hideLoading();
                // Show suggestions page and display backend response
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('suggestionsPage').style.display = 'block';
                
                // Set the captured outfit image
                const capturedImage = document.getElementById('outfitCapturedImage').src;
                const suggestionsImage = document.getElementById('suggestionsOutfitImage');
                if (suggestionsImage && capturedImage) {
                    suggestionsImage.src = capturedImage;
                } else {
                    alert('Could not find suggestions image element or captured image');
                }
                
                // Set the improvements and rating
                document.getElementById('improvementsContent').innerText = data.recommendation || 'No suggestions available';
                
                const ratingElement = document.getElementById('outfitRating');
                if (ratingElement) {
                    ratingElement.innerText = data.rating || 'No rating available';
                }
                
            } catch (err) {
                hideLoading();
                alert('An error occurred: ' + (err.message || 'Unknown error'));
            }
        });
    });

        const outfitTimerSlider = document.getElementById('outfitTimerSlider');
        if (outfitTimerSlider) {
            outfitTimerSlider.addEventListener('input', function() {
                const value = this.value;
                document.getElementById('outfitTimerValue').textContent = value === '0' ? 'Off' : `${value}s`;
            });
        }

        // Close modal on outside click
        document.addEventListener('click', function(event) {
            const outfitModal = document.getElementById('outfitCameraModal');
            if (event.target === outfitModal) {
                stopCamera();
                closeOutfitCameraModal();
            }
        });
    });
    // --- END OUTFIT CAMERA MODAL LOGIC ---

    function uploadPhoto() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = function(event) {
            const file = event.target.files[0];
            if (file) {
                showLoading('Processing your Body Details...');
                const formData = new FormData();
                formData.append('image', file);
                fetch('/image_body_details', {
                    method: 'POST',
                    body: formData
                })
                
                .then(async response => {
                    hideLoading();
                    const data = await response.json();
                    if (response.ok) {
                        const bodyDetails = data.body_details || data;
                        localStorage.setItem('bodyDetails', JSON.stringify(bodyDetails));
                        showResults(bodyDetails);
                        goToOutfitSection();
                        if (capturedImage) { capturedImage.src = URL.createObjectURL(file); }
                    } else {
                        alert('Server error');
                    }
                })
                .catch(err => {
                    hideLoading();
                    alert('An error occurred: ' + (err.error || 'Failed to process image'));
                });
            }
        };
        input.click();
    }

    function captureOutfit() {
        openOutfitCameraModal();
    }

    function uploadOutfitPhoto() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = function(event) {
            const file = event.target.files[0];
            if (file) {
                // Prompt for occasion first
                openOccasionModal(function(){
                    const occasion = localStorage.getItem('occasion');
                    showLoading('Uploading outfit photo...');
                    const user_data = localStorage.getItem('bodyDetails');
                    
                    // Create FormData and append the file
                    const formData = new FormData();
                    formData.append('image', file);
                    formData.append('occasion', occasion);
                    formData.append('user_data', user_data);
                    
                    // Send the request
                    try{
                        fetch('/recommend/image', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            hideLoading();
                            document.getElementById('mainContent').style.display = 'none';
                            document.getElementById('resultsPage').style.display = 'block';
                            document.getElementById('resultImage').src = document.getElementById('outfitCapturedImage').src;
                            document.getElementById('improvementsContent').innerText = data.recommendation || JSON.stringify(data);
                            document.getElementById('outfitRating').innerText = String(data.rating) + "/10";
                            document.getElementById("resultImage").src = URL.createObjectURL(file);
                        })
                        .catch(error => {
                            hideLoading();
                            alert('An error occurred: ' + (error.message || 'Unknown error'));
                        });
                        
                    }
                    catch (err) {
                        hideLoading();
                        alert('An error occurred: ' + (err.message || 'Unknown error'));
                    }

                });
            }
        };
        input.click();
    }

    // Attach handlers to buttons in case HTML is regenerated
    window.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.action-btn').forEach(btn => {
            if (btn.textContent.includes('Capture in Real-time')) btn.onclick = captureRealTime;
            if (btn.textContent.includes('Upload Photo')) btn.onclick = uploadPhoto;
            if (btn.textContent.includes('Enter Manually')) btn.onclick = openManualEntry;
        });
        document.querySelectorAll('.outfit-btn').forEach(btn => {
            if (btn.textContent.includes('Capture Outfit Now')) btn.onclick = captureOutfit;
            if (btn.textContent.includes('Upload Outfit Photo')) btn.onclick = uploadOutfitPhoto;
        });
        document.querySelectorAll('.result-btn').forEach(btn => {
            if (btn.textContent.includes('Home')) btn.onclick = goHome;
            if (btn.textContent.includes('Capture Outfit')) btn.onclick = goToOutfitSection;
        });
        document.querySelectorAll('.panel-btn').forEach(btn => {
            if (btn.textContent.includes('Edit Body Details')) btn.onclick = editProfile;
            if (btn.textContent.includes('View History')) btn.onclick = viewHistory;
        });
        // Ensure sliders update their text values
        const ageSlider = document.getElementById('age');
        const ageValue = document.getElementById('ageValue');
        if (ageSlider && ageValue) {
            ageSlider.addEventListener('input', function() {
                ageValue.textContent = ageSlider.value + ' years';
            });
            ageValue.textContent = ageSlider.value + ' years';
        }
        const heightSlider = document.getElementById('height');
        const heightValue = document.getElementById('heightValue');
        if (heightSlider && heightValue) {
            heightSlider.addEventListener('input', function() {
                heightValue.textContent = heightSlider.value + ' cm';
            });
            heightValue.textContent = heightSlider.value + ' cm';
        }
        const weightSlider = document.getElementById('weight');
        const weightValue = document.getElementById('weightValue');
        if (weightSlider && weightValue) {
            weightSlider.addEventListener('input', function() {
                weightValue.textContent = weightSlider.value + ' kg';
            });
            weightValue.textContent = weightSlider.value + ' kg';
        }
        // Ensure outfit camera modal listeners are always attached
        if (typeof setupOutfitCameraListeners === 'function') {
            setupOutfitCameraListeners();
        }
    });
    window.addEventListener('DOMContentLoaded', function() {
    if (typeof goHome === 'function') {
        goHome();
    } else {
        // Fallback in case goHome is not yet defined
        const mainContent = document.getElementById('mainContent');
        const resultsPageEl = document.getElementById('resultsPage');
        if (mainContent) mainContent.style.display = 'block';
        if (resultsPageEl) resultsPageEl.style.display = 'none';
    }
});

if (document.getElementById('backToMainBtn')) {
    document.getElementById('backToMainBtn').onclick = function() {
        document.getElementById('resultsPage').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
    };
}

// --- Remove any earlier/duplicate DOMContentLoaded handlers for setupOutfitCameraListeners and related modal button listeners ---
// ... existing code ...
// --- At the end of the file, add this unified DOMContentLoaded handler ---
window.addEventListener('DOMContentLoaded', function() {
    // Attach main action and panel button listeners
    document.querySelectorAll('.action-btn').forEach(btn => {
        if (btn.textContent.includes('Capture in Real-time')) btn.onclick = captureRealTime;
        if (btn.textContent.includes('Upload Photo')) btn.onclick = uploadPhoto;
        if (btn.textContent.includes('Enter Manually')) btn.onclick = openManualEntry;
    });
    document.querySelectorAll('.outfit-btn').forEach(btn => {
        if (btn.textContent.includes('Capture Outfit Now')) btn.onclick = captureOutfit;
        if (btn.textContent.includes('Upload Outfit Photo')) btn.onclick = uploadOutfitPhoto;
    });
    document.querySelectorAll('.result-btn').forEach(btn => {
        if (btn.textContent.includes('Home')) btn.onclick = goHome;
        if (btn.textContent.includes('Capture Outfit')) btn.onclick = goToOutfitSection;
    });
    document.querySelectorAll('.panel-btn').forEach(btn => {
        if (btn.textContent.includes('Edit Body Details')) btn.onclick = editProfile;
        if (btn.textContent.includes('View History')) btn.onclick = viewHistory;
    });
    // Ensure sliders update their text values
    const ageSlider = document.getElementById('age');
    const ageValue = document.getElementById('ageValue');
    if (ageSlider && ageValue) {
        ageSlider.addEventListener('input', function() {
            ageValue.textContent = ageSlider.value + ' years';
        });
        ageValue.textContent = ageSlider.value + ' years';
    }
    const heightSlider = document.getElementById('height');
    const heightValue = document.getElementById('heightValue');
    if (heightSlider && heightValue) {
        heightSlider.addEventListener('input', function() {
            heightValue.textContent = heightSlider.value + ' cm';
        });
        heightValue.textContent = heightSlider.value + ' cm';
    }
    const weightSlider = document.getElementById('weight');
    const weightValue = document.getElementById('weightValue');
    if (weightSlider && weightValue) {
        weightSlider.addEventListener('input', function() {
            weightValue.textContent = weightSlider.value + ' kg';
        });
        weightValue.textContent = weightSlider.value + ' kg';
    }
    // --- Outfit Camera Modal Listeners ---
    if (typeof setupOutfitCameraListeners === 'function') {
        setupOutfitCameraListeners();
    }
    const outfitRetakeBtn = document.getElementById('outfitRetakeBtn');
    if (outfitRetakeBtn) outfitRetakeBtn.addEventListener('click', retakeOutfit);
    const outfitNextBtn = document.getElementById('outfitNextBtn');
    if (outfitNextBtn) outfitNextBtn.addEventListener('click', async () => {
        closeOutfitCameraModal();
        const capturedImage = document.getElementById('outfitCapturedImage').src;
        const user_data = localStorage.getItem('bodyDetails');
        if (!capturedImage || !user_data) {
            alert('Missing required data. Please make sure you have entered all details and captured an image.');
            return;
        }
        // Show occasion modal first
        openOccasionModal(async function() {
            const occasion = localStorage.getItem('occasion');
            if (!occasion) {
                alert('Please select an occasion');
                return;
            }
            closeOutfitCameraModal();
            showLoading('Processing your Outfit Details...');
            try {
                stopCamera();
                const resp = await fetch('/recommend/capture', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        outfitImage: capturedImage,
                        occasion: occasion,
                        user_data: user_data
                    })
                });
                const data = await resp.json().catch(e => {
                    throw new Error('Invalid server response');
                });
                if (!resp.ok) {
                    throw new Error(data.error || 'Server returned an error');
                }
                hideLoading();
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('resultsPage').style.display = 'block';
                document.getElementById('resultImage').src = document.getElementById('outfitCapturedImage').src;
                document.getElementById('improvementsContent').innerText = data.recommendation || JSON.stringify(data);
                document.getElementById('outfitRating').innerText = String(data.rating)+"/10";
            } catch (err) {
                hideLoading();
                alert('An error occurred: ' + (err.message || 'Unknown error'));
            }
        });
    });
    const outfitTimerSlider = document.getElementById('outfitTimerSlider');
    if (outfitTimerSlider) {
        outfitTimerSlider.addEventListener('input', function() {
            const value = this.value;
            document.getElementById('outfitTimerValue').textContent = value === '0' ? 'Off' : `${value}s`;
        });
    }
    // Close modal on outside click
    document.addEventListener('click', function(event) {
        const outfitModal = document.getElementById('outfitCameraModal');
        if (event.target === outfitModal) {
            closeOutfitCameraModal();
        }
    });
});
// ... existing code ...

    const cameraCloseBtn = document.getElementById('cameraCloseBtn');
    if (cameraCloseBtn) cameraCloseBtn.addEventListener('click', closeCameraModal);
    document.getElementsByClassName('result-btn1')[0].addEventListener('click', goHome);
</script>
</body>
</html>
